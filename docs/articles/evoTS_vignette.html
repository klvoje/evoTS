<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>evoTS: analysis of evolutionary sequences of phenotypic change • evoTS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="evoTS: analysis of evolutionary sequences of phenotypic change">
<meta property="og:description" content="evoTS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">evoTS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/evoTS_vignette.html">evoTS: analysis of evolutionary sequences of phenotypic change</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>evoTS: analysis of evolutionary sequences of
phenotypic change</h1>
                        <h4 data-toc-skip class="author">Kjetil L.
Voje</h4>
            
            <h4 data-toc-skip class="date">2022-02-09</h4>
      
      
      <div class="hidden name"><code>evoTS_vignette.Rmd</code></div>

    </div>

    
    
<div style="page-break-after: always;"></div>
<div class="section level2">
<h2 id="about-evots">1.0 About <code>evoTS</code><a class="anchor" aria-label="anchor" href="#about-evots"></a>
</h2>
<p>The <code>evoTS</code> package facilitates analysis of evolutionary
sequences of phenotypic change. The package extends the modeling
framework in the <code>paleoTS</code> package (Hunt 2006; 2008a; 2008b;
Hunt <em>et al.</em> 2008; 2010; 2015) and contains functions to fit a
large range of univariate and multivariate evolutionary models not
implemented in <code>paleoTS</code>. The goal of the <code>evoTS</code>
package is to offer a larger range of evolutionary models to te study of
evolutionary changes within lineages.</p>
<p>All model-fitting procedures in <code>evoTS</code> have been
implemented to mirror the user experience from <code>paleoTS</code> in
order to make the package easy to use for users with experince from
<code>paleoTS</code>. For example, all the univariate models implemented
in <code>evoTS</code> can be fitted to a paleoTS object (i.e. the data
format used in <code>paleoTS</code>) and the fit of all univariate
models in <code>paleoTS</code>and <code>evoTS</code> are directly
comparable using the reported AICc. <code>evoTS</code> also contain
functions that allow for more flexibility in fitting combinations of
univariate models to different parts of a time-series. Functions for
investigating likelihood surfaces of fitted models have also been
developed.</p>
<p><code>evoTS</code> also contains a range of multivariate models that
can be fitted to evolutionary sequences (time-series). These models
include different versions of multivariate Unbiased Random Walks and
Ornsten-Uhlenbeck processes.</p>
</div>
<div class="section level2">
<h2 id="installation">2.0 Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>#<code>evoTS</code> can be installed from the CRAN (Comprehensive R
Archive Network) by entering: #
#<code>{r eval = FALSE} #install(evoTS) #</code> #</p>
<p>#The <code>evoTS</code> package is also available on GitHub and can
be installed using devtools: # #
#<code>{r eval = FALSE} #install.packages("devtools") # #devtools::install_github("klvoje/evoTS") #</code>
#</p>
</div>
<div class="section level2">
<h2 id="getting-data-into-evots">3.0 Getting data into <code>evoTS</code><a class="anchor" aria-label="anchor" href="#getting-data-into-evots"></a>
</h2>
<p>The functions in <code>evoTS</code> analyze data on the same format
as <code>paleoTS</code>. An object of class paleoTS is the required
input for most of the functions in `evoTS. To create a paleoTS object,
you need vectors of trait/variable means, sample/population variances,
sample sizes and ages of the samples/populations.</p>
<p>If you already have your data uploaded in R, one easy way to create a
paleoTS object is to use the <code>as.paleoTS</code> function in the
<code>paleoTS</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Creating dummy data </span>
<span class="va">trait_means</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="va">trait_variance</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">20</span><span class="op">)</span>
<span class="va">sample_size</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">20</span><span class="op">)</span>
<span class="va">time_vector</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">20</span>,<span class="fl">1</span><span class="op">)</span>

<span class="co"># Create paleoTS object</span>
<span class="va">indata.evoTS</span><span class="op">&lt;-</span><span class="fu">paleoTS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/paleoTS/man/as.paleoTS.html" class="external-link">as.paleoTS</a></span><span class="op">(</span>mm <span class="op">=</span> <span class="va">trait_means</span>, vv <span class="op">=</span> <span class="va">trait_variance</span>, nn <span class="op">=</span> <span class="va">sample_size</span>, tt <span class="op">=</span> <span class="va">time_vector</span><span class="op">)</span></code></pre></div>
<p>Another way to get data into evoTS is to use the function
read.paleoTS from the <code>paleoTS</code> package. This function
imports data from a text file with four columns corresponding to
trait/variable means, sample/population variances, sample sizes and ages
of the samples/populations and converts the input to a paleoTS
object.</p>
<p>See also the <code>paleoTS</code> (<a href="https://cran.r-project.org/web/packages/paleoTS/vignettes/paleoTS_basics.html" class="external-link">vignette</a>)
for more info on how to import data and create a paleoTS object.</p>
<p>Two evolutionary sequences (time-series) of phenotypic change are
included in the <code>evoTS</code> package. The data are from the diatom
lineage <em>Stephanodiscus yellowstonensis</em> and were originally
published in Theriot <em>et al.</em> (2006).</p>
<p>We will first investigate phenotypic changes in the diameter of
<em>S. yellowstonensis</em>. The data are already an object of class
<code>paleoTS</code>, which is the data type analyzed in
<code>evoTS</code>. The diameter has been measured in micrometres, but
we are interested in investigating proportional changes in the trat. We
therefore first do an approximate log-transformation of the data.We then
convert the time vector in the dataset to unit length (i.e. the length
in time from the oldest to youngest sample/population in the dataset is
1). Such a linear transformation of the time vector does not change how
the estimated parameters describe the evolutionary dynamics in the data,
but ease parameter estimation. We also plot the data to have a look at
the patterns of phenotypic change. .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Doing an approximate log-transformation of the data</span>
<span class="va">ln.diameter</span><span class="op">&lt;-</span><span class="fu">paleoTS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/paleoTS/man/ln.paleoTS.html" class="external-link">ln.paleoTS</a></span><span class="op">(</span><span class="va">diameter_S.yellowstonensis</span><span class="op">)</span>

<span class="co">## Convert the time vector to unit length</span>
<span class="va">ln.diameter</span><span class="op">$</span><span class="va">tt</span><span class="op">&lt;-</span><span class="va">ln.diameter</span><span class="op">$</span><span class="va">tt</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ln.diameter</span><span class="op">$</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Plotting the data</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ln.diameter.paleoTS</span><span class="op">)</span></code></pre></div>
<p><img src="diameter.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="univariate-models-implemented-in-evots">4.0 Univariate models implemented in <code>evoTS</code><a class="anchor" aria-label="anchor" href="#univariate-models-implemented-in-evots"></a>
</h2>
<p>The <code>paleoTS</code> package contains functions to fit biased
(GRW) and unbiased random walks (URW), stasis (modeled as a white noise
process, i.e. uncorrelated variation around a constant mean), strict
stasis (no real evolutionary change) and an Ornstein-Uhlenbeck (OU)
processes assuming a fixed optimum. The paleoTS package also contains
models of a punctuated mode of evolution where stasis is the mode of
evolution inbetween one or two jump in phenotype space
(i.e. punctuation). It is also possible to fit certain models where the
mode of evolution shifts at some point during the evolutionary
sequence.</p>
<p>Several new univariate models have been implemented in the
<code>evoTS</code> package. Functions are also available to fit mode
shifts between all univariate models available in <code>evoTS</code> and
<code>paleoTS</code> combined. There are also functions available in
<code>evoTS</code> that allow for more than one mode shift during the
analyzed evolutionary sequence.</p>
<p>The following univariate models have been implemented in the
<code>evoTS</code> package:</p>
<ol style="list-style-type: decimal">
<li>Decerelated-evolution model (an unbiased random walk with an
exponential decrease in the rate of change over time)</li>
<li>Accelerated-evolution model (an unbiased random walk with an
exponential increase in the rate of change over time)</li>
<li>The Bokma model (a punctuated equilibrium model where two (or three)
unbiased random walks are separated by one (or two) jump(s) in
morphospace)</li>
<li>Ornstein-Uhlenbeck process where the optimum changes according to an
unbiased random walk.</li>
</ol>
<div class="section level4">
<h4 id="decelerated-evolution-model">4.1 Decelerated-evolution model<a class="anchor" aria-label="anchor" href="#decelerated-evolution-model"></a>
</h4>
<p>The decelerated model of phyletic evolution is a unbiased random walk
where the step variance (i.e. the variance of the normal distribution
from which evolutionary steps are drawn) is reduced exponentially
through time (Voje 2020). This model is closely related to the early
burst model developed for phylogenetic comparative data (Blomberg <em>et
al.</em> 2003; Harmon <em>et al.</em> 2010, Cooper and Purvis 2010).</p>
<p>The decerelated model of evolution can be fitted to data usign the
<code>opt.joint.decel</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt.joint.decel</span>(ln.diameter)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">76.77642</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">147.1461</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>       anc      vstep          r </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.8868739</span>  <span class="fl">0.2892461</span> <span class="sc">-</span><span class="fl">1.8076302</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Decel"</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The output returns the log-likelihood of the model parameter (logl),
the AICc score (AICc), the number (K) of estimated parameters
(parameters), the length of the analysed time-series (n), the model name
(Decel) and the method used to parameterize the model (Joint).
<em>anc</em> is the estimated ancestral trait, <em>vstep</em> is initial
value for the step distribution, and <em>r</em> describes the
exponential decay in the <em>vstep</em> parameter through time. The
half-life is (-ln(2)/r) 0.38. The half-life parameter is interpreted
based on the time-scale used when analyzing the data. Since time from
start to end in the has been scaled to unit length, the estimated
half-life represent the percent of the total length of the time-series
it takes for the rate of evolution to half. The total length of the
analyzed time-series is 13,728 years, which means it takes 5,217 years
for the rate of evolution to be halved.</p>
<p>The evoTS package contains functions to explore the
likelihood-surface of the fitted model. Investigating the likelihood
surface can be helpful for several reasons.</p>
<ol style="list-style-type: decimal">
<li>Estimating parameters in a model using maximum likelihood always run
the risk of returning parameters from a local and not a global optimum.
Investigating the support surface for combinations of parameters is one
way to explore the topology of the likelihood-surface.</li>
<li>Computing the likelihood surface is a great way to explore which
parameter combinations that have an almost identical likelihood compared
to the maximum likelihood values. Ridges in the log-likelihood surface
can make it challenging to identify maximum likelihood estimates of the
model parameters in certain cases. Flat ridges may cause identifiability
issues and problems for the model to converge.</li>
<li>Investigating the likelihood surface is also an approach to assess
uncertainty in the estimated parameters. A large range of parameter
values that have almost the same log-likelihood is an indication that we
should be careful when interpreting the maximum-likelihood (best)
estimates of the parameters. The functions in <code>evoTS</code>
calculating log-likelihood surfaces report the upper and lower parameter
estimates that are within two support units of the best estimate as a
way to assess uncertainty in parameters (Edwards 1992).</li>
</ol>
<p>Functions to create likelihood surfaces for univariate models in
<code>evoTS</code> and <code>paleoTS</code> are included in
<code>evoTS</code> (e.g. <code>confidence.stasis</code>,
<code>confidence.URW</code>, <code>confidence.GRW</code>,
<code>confidence.OU</code>). These functions need a paleoTS object and a
set of candidate values for the parameters to be evaluated. One way to
define the candidate values is to use the <code>seq</code> function. The
vectors given to the arguments vstep.vec and r.vec defines the pairwise
combinations of parameters for which the function will estimate the
log-likelihood. How fine-scaled the estimated log-likelihood surface is
depends on the step size between the values in the input-vectors. The
step-size therefore determines how accurate the representation of the
support surface is, including the returned upper and lower estimates
printed in the console. Note that the computed support surface is
conditional on the best estimates of the other model parameters that are
not part of the support surface (e.g. the estimated ancestral trait
value).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">confidence.decel</span>(ln.diameter, <span class="at">vstep.vec =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">1.2</span>,<span class="fl">0.01</span>), <span class="at">r.vec =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="fl">0.01</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      lower upper</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>vstep  <span class="fl">0.17</span>  <span class="fl">1.00</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>r     <span class="sc">-</span><span class="fl">3.70</span> <span class="sc">-</span><span class="fl">0.28</span></span></code></pre></div>
<p><img src="decel_logl_surface.png" width="80%" style="display: block; margin: auto;"></p>
<p>From the likelihood surface in Figure 1 and from the printed
confidence intervals, we see that r values between -0.28 and -3.70 are
within 2 log-likelihood units from the best estimate for this parameter.
This suggests it is hard to exclude the possibility that the half-life
of the decay in the rate of evolution is as much as 248% (34,045 years)
or as low as 19% (2,608 years) of the time-interval investigated.</p>
</div>
<div class="section level3">
<h3 id="accelerated-evolution-model">4.2 Accelerated-evolution model<a class="anchor" aria-label="anchor" href="#accelerated-evolution-model"></a>
</h3>
<p>The accelerated evolution model is identical to the decelerated model
except that the r parameter is constrained to be 0 or larger, which
means the rate of evolution is accelerating with time.</p>
<p>The accelerated evolution model can be fitted using the
<code>opt.joint.accel</code> function. </p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt.joint.accel</span>(ln.diameter)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">73.80287</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">141.199</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      anc     vstep         r </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fl">3.7078973</span> <span class="fl">0.7903365</span> <span class="fl">0.2630122</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Accel"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The accelerated evolution model has a lower (worse) log-likelihood
and higher (worse) AICc score compared to the decelerated model of
evolution (page 2).</p>
<p>A support surface can be produced using the confidence.accel
function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">confidence.accel</span>(ln.diameter, <span class="at">vstep =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fl">0.01</span>), <span class="at">r.vec =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">1.5</span>, <span class="fl">0.005</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      lower upper</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>vstep  <span class="fl">0.17</span>  <span class="fl">1.00</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>r     <span class="sc">-</span><span class="fl">3.70</span> <span class="sc">-</span><span class="fl">0.28</span></span></code></pre></div>
<p><img src="accel_logl_surface.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="the-bokma-model">4.3 The Bokma model<a class="anchor" aria-label="anchor" href="#the-bokma-model"></a>
</h3>
<p>The <code>paleoTS</code> package contains models that portray a
punctuated mode of evolution as a white noise process (stasis)
punctuated by jumps in phenotype space (the function
<code>opt.joint.punc</code>). Bokma (2002) suggested a different model
as an interpretation of a punctuated mode of evolution along branches on
a phylogeny (see also Ingram 2011 and Hunt 2013). According to Bokma’s
(2002) model, a trait is evolving as a unbiased random walk in between
punctuations. This model is implemented in the <code>evoTS</code>
package and can be ran using the function <code>fit.PE.Bokma</code> The
rate parameter (<em>vstep</em>) in the unbiased random walks before and
adter a punctation event is free to differ. The function investigates
and compares all possible locations for the punctuation and returns the
shift point and the parameter values with the highest log-likelihood for
each of the two unbiased random walks. The length of the shortest
sequence (i.e. the number of samples/populations) that is used to
parameterize each random walk is defined by the argument
<code>minb.</code> The user can also define which sample/population in
the time series that represents the punctuation event using the argument
<code>shift.point</code> (e.g. shift.point=20). Fitting Bokma’s model
with two punctuations and parameterizing three unbiased random walks can
be done by using the function <code>fit.2.PE.Bokma</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.Bokma</span>(ln.diameter, <span class="at">minb=</span><span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Searching for all possible switchpoints in timeseries"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>Total <span class="co"># hypotheses:  44 </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span>  <span class="dv">35</span>  <span class="dv">36</span>  <span class="dv">37</span>  <span class="dv">38</span>  <span class="dv">39</span>  <span class="dv">40</span>  <span class="dv">41</span>  <span class="dv">42</span>  <span class="dv">43</span>  <span class="dv">44</span>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">83.38311</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">155.7136</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>       anc    vstep_1    new.opt    vstep_2     shift1 </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.7157502</span>  <span class="fl">0.3419322</span>  <span class="fl">4.1349082</span>  <span class="fl">0.1668632</span> <span class="fl">18.0000000</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"PE.Bokma"</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>all.logl</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="fl">80.31088</span> <span class="fl">79.51765</span> <span class="fl">80.01722</span> <span class="fl">79.66074</span> <span class="fl">80.48083</span> <span class="fl">79.89100</span> <span class="fl">79.42840</span> <span class="fl">83.38311</span> <span class="fl">80.77101</span> <span class="fl">80.77826</span> <span class="fl">79.85728</span> <span class="fl">79.68613</span> <span class="fl">79.59643</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">14</span>] <span class="fl">79.44200</span> <span class="fl">82.63356</span> <span class="fl">81.44387</span> <span class="fl">81.21899</span> <span class="fl">81.02157</span> <span class="fl">82.02478</span> <span class="fl">80.99060</span> <span class="fl">80.56377</span> <span class="fl">81.29680</span> <span class="fl">80.52947</span> <span class="fl">80.10540</span> <span class="fl">80.41855</span> <span class="fl">80.58089</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">27</span>] <span class="fl">80.27750</span> <span class="fl">80.49915</span> <span class="fl">79.77512</span> <span class="fl">79.54571</span> <span class="fl">79.07448</span> <span class="fl">79.59706</span> <span class="fl">79.30831</span> <span class="fl">79.04140</span> <span class="fl">79.46599</span> <span class="fl">79.23228</span> <span class="fl">78.96974</span> <span class="fl">78.89496</span> <span class="fl">78.87805</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] <span class="fl">79.21300</span> <span class="fl">79.62620</span> <span class="fl">79.49839</span> <span class="fl">79.30760</span> <span class="fl">79.69878</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>GG</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>] [,<span class="dv">4</span>] [,<span class="dv">5</span>] [,<span class="dv">6</span>] [,<span class="dv">7</span>] [,<span class="dv">8</span>] [,<span class="dv">9</span>] [,<span class="dv">10</span>] [,<span class="dv">11</span>] [,<span class="dv">12</span>] [,<span class="dv">13</span>] [,<span class="dv">14</span>] [,<span class="dv">15</span>] [,<span class="dv">16</span>] [,<span class="dv">17</span>] [,<span class="dv">18</span>] [,<span class="dv">19</span>] [,<span class="dv">20</span>]</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]   <span class="dv">11</span>   <span class="dv">12</span>   <span class="dv">13</span>   <span class="dv">14</span>   <span class="dv">15</span>   <span class="dv">16</span>   <span class="dv">17</span>   <span class="dv">18</span>   <span class="dv">19</span>    <span class="dv">20</span>    <span class="dv">21</span>    <span class="dv">22</span>    <span class="dv">23</span>    <span class="dv">24</span>    <span class="dv">25</span>    <span class="dv">26</span>    <span class="dv">27</span>    <span class="dv">28</span>    <span class="dv">29</span>    <span class="dv">30</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">21</span>] [,<span class="dv">22</span>] [,<span class="dv">23</span>] [,<span class="dv">24</span>] [,<span class="dv">25</span>] [,<span class="dv">26</span>] [,<span class="dv">27</span>] [,<span class="dv">28</span>] [,<span class="dv">29</span>] [,<span class="dv">30</span>] [,<span class="dv">31</span>] [,<span class="dv">32</span>] [,<span class="dv">33</span>] [,<span class="dv">34</span>] [,<span class="dv">35</span>] [,<span class="dv">36</span>] [,<span class="dv">37</span>] [,<span class="dv">38</span>] [,<span class="dv">39</span>]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">31</span>    <span class="dv">32</span>    <span class="dv">33</span>    <span class="dv">34</span>    <span class="dv">35</span>    <span class="dv">36</span>    <span class="dv">37</span>    <span class="dv">38</span>    <span class="dv">39</span>    <span class="dv">40</span>    <span class="dv">41</span>    <span class="dv">42</span>    <span class="dv">43</span>    <span class="dv">44</span>    <span class="dv">45</span>    <span class="dv">46</span>    <span class="dv">47</span>    <span class="dv">48</span>    <span class="dv">49</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">40</span>] [,<span class="dv">41</span>] [,<span class="dv">42</span>] [,<span class="dv">43</span>] [,<span class="dv">44</span>]</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">50</span>    <span class="dv">51</span>    <span class="dv">52</span>    <span class="dv">53</span>    <span class="dv">54</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The model with the highest likelihood has a punctuation event at
sample (population) 18. The rate of evolution before the punctuation
(<em>v_step.1</em>) is about twice the magnitude of the rate of
evolution after the punctuation (<em>v_step.2</em>).</p>
<p>Note: <code>all.logl</code> lists the log-likelihoods for each of the
investigated shift points. All investigated shift points are given by
<code>GG</code>.</p>
<p>The log-likelihood surface can be investigated using the
<code>confidence.PE.Bokma</code> function. Notice that we need to
condition the estimated log-likelihoods for the pairwise parameter
combinations of <em>vstep_1</em> and <em>vstep_2</em> on the most likely
parameter estimates of the punctuation (<em>shift1</em>), ancestral
trait value (<em>anc</em>) and the new optimum after the punctuation
(<em>new.opt</em>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">confidence.PE.Bokma</span> (ln.diameter.paleoTS, <span class="at">vstep_1.vec=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.01</span>), <span class="at">vstep_2.vec=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.4</span>, <span class="fl">0.01</span>),<span class="at">shift=</span><span class="dv">18</span>, <span class="at">anc=</span><span class="fl">3.7157502</span>  , <span class="at">new.opt=</span><span class="fl">4.1349082</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        lower upper</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>vstep_1  <span class="fl">0.14</span>  <span class="fl">0.91</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>vstep_2  <span class="fl">0.10</span>  <span class="fl">0.30</span></span></code></pre></div>
<p><img src="boka_logl_surface.png" width="60%" style="display: block; margin: auto;"></p>
<p>We can compare the fit of the Bokma model to the alternative
interpretation of a punctuated mode of evolution where the trait evolves
according to a model of stasis in between the punctuation events. This
model is implemented in <code>paleoTS</code> and can be fitted using the
<code>fitGpunc</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Bokma.PE<span class="ot">&lt;-</span><span class="fu">fit.PE.Bokma</span>(ln.diameter, <span class="at">minb=</span><span class="dv">10</span>, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Searching for all possible switchpoints in timeseries"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Stasis.PE<span class="ot">&lt;-</span>paleoTS<span class="sc">::</span><span class="fu">fitGpunc</span>(ln.diameter, <span class="at">minb=</span><span class="dv">10</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>Bokma.PE<span class="sc">$</span>AICc;Stasis.PE<span class="sc">$</span>AICc</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">155.7136</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">87.63458</span></span></code></pre></div>
<p>The model where the trait evolves as a unbiased random walk between
the punctuation event (i.e. the Bokma model) has the best relative fit
in this case.</p>
</div>
<div class="section level3">
<h3 id="ornstein-uhlenbeck-model-with-an-optimum-changing-according-to-an-unbiased-random-walk-">4.4 Ornstein-Uhlenbeck model with an optimum changing according to
an unbiased random walk.<a class="anchor" aria-label="anchor" href="#ornstein-uhlenbeck-model-with-an-optimum-changing-according-to-an-unbiased-random-walk-"></a>
</h3>
<p>The <code>paleoTS</code> package includes an Ornstein-Uhlenbeck (OU)
model of evolution with a single and fixed optimum (Hunt <em>et al.</em>
2008). This model portrays evolutionary adaptation of a trait towards a
fixed peak on the adaptive landscape. The <code>evoTS</code> package
contains an OU model where the optimum (peak) is not fixed but is
constantly changing according to an unbiased random walk. Such a model
was proposed by Hansen <em>et al.</em> (2008) for analyses of
phylogenetic comparative data. Adjusted to describe evolution of a
single lineage, the expected trait mean and its variance and covariance
are given by the following expressions:</p>
<p><span class="math display">\[E[z_{i}] = e^{(-\alpha t_{i})}z_{0} +
[1-e^{-\alpha t_{i}}]\theta\]</span> <span class="math display">\[Var[z_{i}] =\left[ \frac{
\sigma^{2}_{step}+\sigma^{2}_{\theta}}{2\alpha} \right] \left[
1-e^{(-2\alpha t_{i})}\right] + \sigma^{2}_{\theta}t_{i}
\left[  1-2(1-e^{-\alpha t_{i}}) \right]/\alpha t_{i} + \epsilon _{i}
\]</span> <span class="math display">\[Cov[z_{i},z_{j}] =\left[ \frac{
\sigma^{2}_{step}+\sigma^{2}_{\theta}}{2\alpha} \right] \left[
1-e^{(-2\alpha t_{a})}\right]e^{-\alpha t_{ij}} +
\sigma^{2}_{\theta}t_{a} \left[  1-\left[1+e^{-\alpha t_{ij}} \right]
\left( 1-e^{-\alpha t_{a}} \right) \right] /  \alpha t_{i} + \epsilon
_{i} \]</span></p>
<p>The model can be fitted using the <code>opt.joint.OUBM</code>
function.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">opt.joint.OUBM</span>(ln.diameter)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Running no iterations."</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">78.5667</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">148.4437</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>anc<span class="sc">/</span>theta<span class="fl">.0</span> vstep.trait       alpha   vstep.opt </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.71050957</span>  <span class="fl">0.25577376</span>  <span class="fl">4.45009847</span>  <span class="fl">0.00000001</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"OU w. moving optimum (anc at opt)"</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The <em>vstep.opt</em> parameter represent the rate of change in the
optimum. This is extremely small (virtually zero), which means the
optimum is essentially fixed. The alpha in the OU model represents the
strength of the pull towards the optimum. A parameter that is easier to
interpret compared to the alpha is the half-life
(log(2)/<em>alpha</em>), which is the time it takes for the trait to
move half-way to the optimum from the ancestral state. The half life is
therefore a quantification of the speed of adaptation towards the
optimal state. As for the decelerated and accelerated models of
evolution, the interpretation of the half life depends on the
time-interval covered by the time-series. Since the time-interval of the
time-series is scaled to unit length (i.e. the time from the start to
the end of the time-series is 1), this means the half-life can be
interpreted as the percent of the total length of the time-series. The
half-life in our example is (log(2)/<em>alpha</em> =) 0.16. According to
this point estimate, it takes the trait 16% of the total length of the
time-series to evolve half-way towards the optimum, which is about
(13,728 years * 0.16 =) 2197 years.</p>
<p>Notice that the name of the first reported parameter is
<em>anc</em>/<em>theta.0</em>. This parameter represents the ancestral
trait value, but also the value of the “ancestral” optimum. The default
option in the <code>opt.joint.OUBM</code> function is to assume that the
trait was perfectly adapted at the start of the time-series (the
argument <code>anc.opt = TRUE</code>), but this can be changed by
setting <code>anc.opt = FALSE</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">opt.joint.OUBM</span>(ln.diameter, <span class="at">opt.anc  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Running no iterations."</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">80.71298</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">150.3733</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        anc vstep.trait     theta<span class="fl">.0</span>       alpha   vstep.opt </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.70318166</span>  <span class="fl">0.27295537</span>  <span class="fl">3.89044816</span> <span class="fl">11.89404598</span>  <span class="fl">0.00000001</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"OU w. moving optimum"</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>Notice that a separate “ancestral” value for the optimum
(<em>theta.0</em>) is estimated which is different from the ancestral
trait value. The rate of change in the optimum is still negligible,
which means this model is virtually identical to a model where the
optimum is fixed. This can be shown by fitting an OU model where the
optimum is fixed, a model included in the <code>paleoTS</code>
package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>paleoTS<span class="sc">::</span><span class="fu">opt.joint.OU</span>(ln.diameter)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">80.71298</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">152.7363</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>       anc      vstep      theta      alpha </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.7031755</span>  <span class="fl">0.2729606</span>  <span class="fl">3.8904481</span> <span class="fl">11.8940464</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"OU"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The fixed optimum model gives the same log-likelihood value as model
where the optimum was allowed to change (but actually didn’t). The fixed
optimum model has a better AICc score as this model contains one less
parameter (the parameter describing the rate of change in the
optimum).</p>
<p>It is good practice to repeat any numerical optimization procedure
from different starting points. This is especially important when the
model has several parameters, as parameter-rich models may contain more
than one peak in the log-likelihood surface. The OUBM model is a type of
model that may have several local peaks in the likelihood space. The
user can choose the number of iterations of the numerical optimization
of the OUBM model using the argument iterations. The function will
return the parameter values from the run with the highest likelihood,
along with the number of optima found and their distance in units of
log-likelihood to the highest detected peak. The starting values in each
iteration are drawn from a normal distribution with mean zero and a
standard deviation set by the user (default is 1). The initial values
for the vstep, alpha and the omega parameters are constrained to be
equal or largen than 0.</p>
<p>Here, we run the opt.joint.OUBM function (assuming the trait value is
perfectly adapted at the start of the sequence) from 1,000 different
starting points:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">opt.joint.OUBM</span>(ln.diameter, <span class="at">opt.anc =</span> <span class="cn">TRUE</span>, <span class="at">iterations =</span> <span class="dv">100</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">78.5667</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">148.4437</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>anc<span class="sc">/</span>theta<span class="fl">.0</span> vstep.trait       alpha   vstep.opt </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.71050959</span>  <span class="fl">0.25577389</span>  <span class="fl">4.45010533</span>  <span class="fl">0.00000001</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"OU w. moving optimum (anc at opt)"</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">100</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>From the output, we see that the likelihood score of the best model
among the 100 model runs is identical to the score when running the
model without iterations of the starting values of the parameters.
However, the maximum likelihood parameter estimates are slightly
different (e.g. a differce in the sixth decimal for the <em>vstep</em>
parameter), but not to an extent that changes our interpretation of the
trait dynamics. This suggests that the detected peak in the
log-likelihood landscape is not completely smooth, and that there exists
minuscule spikes very close to each other at the peak.</p>
<p>The <code>evoTS</code> package contains functions to estimate
likelihood surfaces for the different versions of the OU models
(<code>confidence.OU</code> and <code>confidence.OU.BM</code>). In these
functions, the likelihood surface is not estimated as a function of the
step variance and alpha parameter directly, but rather as a function of
two related parameters that are easier to give a biological
interpretation. The stationary variance (<em>vstep</em>/2**alpha<em>)
represents the equilibrium variance of the OU process (Hansen et
al. 2008) and describes the variance expected in the trait after the
trait has reached the optimum. The half-life (log(2)/</em>alpha*) is the
amount of time it takes for the trait to move half-way from the
ancestral state to the optimum. The half-life is informative regarding
the speed of adaptation toward the optimal state.</p>
<p>The OU model with a fixed optimum had the best relative model fit
according to AICc among the three versions of the OU model we
investigated. The half-life from this OU-model is (log(2)/ 11.8941) =
0.0583. Since we scaled the time-interval of the time-series to unit
length (i.e. the time from the start to the end of the time-series is
1), this means it takes about 6% of the length of our data to get
half-way to the optimal value. The total length of our time-series in
years is 13,728, which means it takes (13728 * 0.0583 = ) 800 years to
get half-way to the optimum. But this is only a point-estimate. We can
explore the support interval around this point estimate of the half-life
(and the stationary variance) using the <code>confidence.OU</code>
function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="fu">confidence.OU</span>(ln.diameter, <span class="at">stat.var.vec=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.1</span>,<span class="fl">0.001</span>), <span class="at">h.vec=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="fl">0.001</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>      lower upper</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>stationary variance <span class="fl">0.007</span> <span class="fl">0.053</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>half<span class="sc">-</span>life           <span class="fl">0.029</span> <span class="fl">0.305</span></span></code></pre></div>
<p><img src="OU_logl_surface.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="fitting-all-univariate-models-implemented-in-evots-and-paleots-to-a-timeseries">4.5 Fitting all univariate models implemented in <code>evoTS</code>
and <code>paleoTS</code> to a timeseries<a class="anchor" aria-label="anchor" href="#fitting-all-univariate-models-implemented-in-evots-and-paleots-to-a-timeseries"></a>
</h3>
<p>A quick way to evaluate the relative fit of all univariate models in
the <code>evoTS</code> and <code>paleoTS</code>packages (excluding
models with more than one puntuation) is to use the
<code>fit.all.univariate.models</code> function.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.all.univariate.models</span>(ln.diameter)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Omitting to show some of the output to save length. </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>Comparing <span class="dv">11</span> models [n <span class="ot">=</span> <span class="dv">63</span>, method <span class="ot">=</span> Joint]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                        logL K       AICc Akaike.wt</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>GRW                                 <span class="fl">77.64073</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">148.87469</span>     <span class="fl">0.022</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>URW                                 <span class="fl">77.57018</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">150.94035</span>     <span class="fl">0.063</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>Stasis                              <span class="fl">39.84019</span> <span class="dv">2</span>  <span class="sc">-</span><span class="fl">75.48039</span>     <span class="fl">0.000</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>StrictStasis                      <span class="sc">-</span><span class="fl">707.46411</span> <span class="dv">1</span> <span class="fl">1416.99379</span>     <span class="fl">0.000</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>Decel                               <span class="fl">76.77642</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">147.14607</span>     <span class="fl">0.009</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>Accel                               <span class="fl">73.80287</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">141.19896</span>     <span class="fl">0.000</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>OU                                  <span class="fl">80.71298</span> <span class="dv">4</span> <span class="sc">-</span><span class="fl">152.73631</span>     <span class="fl">0.155</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>OU w. moving <span class="fu">optimum</span> (anc at opt)   <span class="fl">78.56670</span> <span class="dv">4</span> <span class="sc">-</span><span class="fl">148.44374</span>     <span class="fl">0.018</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>OU w. moving optimum                <span class="fl">80.71298</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">150.37333</span>     <span class="fl">0.047</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>Punc<span class="dv">-1</span>                              <span class="fl">50.03827</span> <span class="dv">4</span>  <span class="sc">-</span><span class="fl">91.38688</span>     <span class="fl">0.000</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>PE.Bokma                            <span class="fl">83.38311</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">155.71359</span>     <span class="fl">0.685</span></span></code></pre></div>
<p>The Bokma model where the trait evolves as a random walk before and
after the punctuation outcompetes the OU model according to AICc.</p>
<p>Where the jump happens can be investigated by plotting the data and
putting a line at the estimated switch point.</p>
<p><img src="diameter_jump.png" width="60%" style="display: block; margin: auto;"></p>
<p>The switch point is estimated to ihappen where there is no obvious
and large jump in the evolution of the trait along the y axis. The
reason why this model fits better than the other candidate models might
therefore be unrelated to the jump itself and may instead be due to the
fact that the rate of evolution is allowed to be different before and
after the punctuation. The rate parameter (<em>vstep_1</em>) of the
unbiased random walk before the punctuation is indeed about twice as
large as the rate parameter (<em>vstep_2</em>) in the unbiased random
walk after the puntuation.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Bokma.PE<span class="sc">$</span>parameters</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       anc    vstep_1    new.opt    vstep_2     shift1 </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.7157502</span>  <span class="fl">0.3419322</span>  <span class="fl">4.1349082</span>  <span class="fl">0.1668632</span> <span class="fl">18.0000000</span> </span></code></pre></div>
<p>We should therefore investigate whether a model that fits two
separate unbiased random walks to two non-overlapping segments of the
time-series is able to outcompete the Bokma model.</p>
</div>
<div class="section level3">
<h3 id="fitting-combinations-of-univariate-models-to-a-timeseries">4.6 Fitting combinations of univariate models to a timeseries<a class="anchor" aria-label="anchor" href="#fitting-combinations-of-univariate-models-to-a-timeseries"></a>
</h3>
<p>There is no a priori reason why a lineage should follow a single mode
of evolution. The <code>evoTS</code> package allows for investigating
all pairwise model combinations of the models Stasis, Unbiased random
walk (WRW), Trend (GRW) and Ornstein-Uhlenbek (OU) using the function
<code>fit.two.univariate.models</code>.</p>
<p>We are interested in investigating whether a model consisting of two
different random walks fits the data better compared to a punctuated
evolution model (The Bokma model). We can constrain the function to only
investigate the same shift point as the one found to be the best for the
Bokma model using the argument <code>shift.point</code>. However, we are
interested in investigating all possible switch points.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fit.two.univariate.models</span>(ln.diameter, <span class="at">model1 =</span> <span class="st">"URW"</span>, <span class="at">model2 =</span> <span class="st">"URW"</span>, <span class="at">minb =</span> <span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Searching all possible switchpoints in the evolutionary sequence"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Total <span class="co"># hypotheses:  44 </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span>  <span class="dv">35</span>  <span class="dv">36</span>  <span class="dv">37</span>  <span class="dv">38</span>  <span class="dv">39</span>  <span class="dv">40</span>  <span class="dv">41</span>  <span class="dv">42</span>  <span class="dv">43</span>  <span class="dv">44</span>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">79.27473</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">149.8598</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>       anc      vstep      vstep     shift1 </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.7304865</span>  <span class="fl">0.2432594</span>  <span class="fl">0.2494817</span> <span class="fl">52.0000000</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"URW-URW"</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>all.logl</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="fl">70.86731</span> <span class="fl">68.59747</span> <span class="fl">62.65156</span> <span class="fl">65.41455</span> <span class="fl">53.23718</span> <span class="fl">60.25449</span> <span class="fl">56.19608</span> <span class="fl">45.50594</span> <span class="fl">42.55632</span> <span class="fl">44.70092</span> <span class="fl">46.05836</span> <span class="fl">46.58797</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="fl">48.14004</span> <span class="fl">44.19647</span> <span class="fl">67.63474</span> <span class="fl">57.82010</span> <span class="fl">64.69928</span> <span class="fl">69.73926</span> <span class="fl">58.45089</span> <span class="fl">55.26295</span> <span class="fl">53.40897</span> <span class="fl">64.95625</span> <span class="fl">66.97684</span> <span class="fl">66.65108</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="fl">72.98220</span> <span class="fl">65.42928</span> <span class="fl">71.12637</span> <span class="fl">76.39216</span> <span class="fl">74.96141</span> <span class="fl">74.07654</span> <span class="fl">74.06923</span> <span class="fl">77.98640</span> <span class="fl">75.27489</span> <span class="fl">73.96364</span> <span class="fl">78.18181</span> <span class="fl">74.92223</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="fl">75.10229</span> <span class="fl">77.07127</span> <span class="fl">77.28518</span> <span class="fl">79.12256</span> <span class="fl">75.99980</span> <span class="fl">79.27473</span> <span class="fl">76.45725</span> <span class="fl">70.37393</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>GG</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>shift1 </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="dv">52</span> </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The fit of this model is similar (but worse) according to AICc
compared to the Bokma model model.</p>
<p>It is also possible to use the function
<code>fit.two.univariate.models</code> to fit all pairwise combinations
of the four models by setting the <code>fit.all</code> argument as TRUE.
If a shift point is not defined (using the <code>shift.point</code>
argument), all possible shift points are investigated for all
models.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.two.univariate.models</span>(ln.diameter, <span class="at">fit.all =</span> <span class="cn">TRUE</span>, <span class="at">minb =</span> <span class="dv">10</span>, )</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Searching all possible switchpoints in the evolutionary sequence"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span>  <span class="dv">35</span>  <span class="dv">36</span>  <span class="dv">37</span>  <span class="dv">38</span>  <span class="dv">39</span>  <span class="dv">40</span>  <span class="dv">41</span>  <span class="dv">42</span>  <span class="dv">43</span>  <span class="dv">44</span>  </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Comparing <span class="dv">16</span> models [n <span class="ot">=</span> <span class="dv">63</span>, method <span class="ot">=</span> Joint]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                  logL K       AICc Akaike.wt</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>Stasis<span class="sc">-</span>Stasis <span class="fl">53.41478</span> <span class="dv">4</span>  <span class="sc">-</span><span class="fl">98.13991</span>     <span class="fl">0.000</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>Stasis<span class="sc">-</span>URW    <span class="fl">72.84306</span> <span class="dv">4</span> <span class="sc">-</span><span class="fl">136.99646</span>     <span class="fl">0.000</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>Stasis<span class="sc">-</span>GRW    <span class="fl">72.84414</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">134.63564</span>     <span class="fl">0.000</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>Stasis<span class="sc">-</span>OU     <span class="fl">74.97027</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">136.44053</span>     <span class="fl">0.000</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>URW<span class="sc">-</span>URW       <span class="fl">79.27473</span> <span class="dv">4</span> <span class="sc">-</span><span class="fl">149.85981</span>     <span class="fl">0.001</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>URW<span class="sc">-</span>GRW       <span class="fl">79.54430</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">148.03597</span>     <span class="fl">0.000</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>URW<span class="sc">-</span>OU        <span class="fl">85.32562</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">157.15123</span>     <span class="fl">0.036</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>GRW<span class="sc">-</span>GRW       <span class="fl">84.03615</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">154.57229</span>     <span class="fl">0.010</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>GRW<span class="sc">-</span>OU        <span class="fl">88.86992</span> <span class="dv">7</span> <span class="sc">-</span><span class="fl">161.70347</span>     <span class="fl">0.350</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>OU<span class="sc">-</span>OU         <span class="fl">88.34795</span> <span class="dv">8</span> <span class="sc">-</span><span class="fl">158.02923</span>     <span class="fl">0.056</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>OU<span class="sc">-</span>GRW        <span class="fl">84.14765</span> <span class="dv">7</span> <span class="sc">-</span><span class="fl">152.25894</span>     <span class="fl">0.003</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>OU<span class="sc">-</span>URW        <span class="fl">83.90670</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">154.31340</span>     <span class="fl">0.009</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>OU<span class="sc">-</span>Stasis     <span class="fl">87.66071</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">161.82143</span>     <span class="fl">0.372</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>GRW<span class="sc">-</span>URW       <span class="fl">83.79338</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">156.53412</span>     <span class="fl">0.026</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>GRW<span class="sc">-</span>Stasis    <span class="fl">86.53257</span> <span class="dv">6</span> <span class="sc">-</span><span class="fl">159.56513</span>     <span class="fl">0.120</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>URW<span class="sc">-</span>Stasis    <span class="fl">83.34316</span> <span class="dv">5</span> <span class="sc">-</span><span class="fl">155.63369</span>     <span class="fl">0.017</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">87.66071</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">161.8214</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>         anc        vstep     theta_OU        alpha        omega       shift1 </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.695580875</span>  <span class="fl">0.323335244</span>  <span class="fl">3.814178130</span>  <span class="fl">5.226496747</span>  <span class="fl">0.001760509</span> <span class="fl">38.000000000</span> </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"OU-Stasis"</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">6</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>GG</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>shift1 </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    <span class="dv">38</span> </span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The function returns a list of the highest log-likelihood found for
each model. A detailed output from the model with the lowest AICc value
among the 16 candidate models is also given. An OU-Stasis model with a
shift point at sample (population) 38 has the best relative fit
according to AICc. Note, however, that the model-combination Trend-OU
(GRW-OU) has an almost equal AICc score relative to the best model.
These two models show an almost identical relative fit to the data.
Also, the combination of OU models (each with their own fixed optimum)
shows a good relative fit to the data. All these three models have a
better AICc score compared to the Bokma model.</p>
</div>
</div>
<div class="section level2">
<h2 id="multivariate-models">5.0 Multivariate models<a class="anchor" aria-label="anchor" href="#multivariate-models"></a>
</h2>
<p>Traits are rarely changing independently of each other due to shared
genetics or development. Evolution is accordingly a multivariate
phenomenon. The <code>evoTS</code> package includes functions to fit the
following multivariate trait models:</p>
<pre><code>*   Multivariate unbiased random walks
*   Multivariate decelerated evolution
*   Multivariate accelerated evolution
*   Multivariate Ornstein-Uhlenbeck processes </code></pre>
<div class="section level4">
<h4 id="multivariate-unbiased-random-walks-with-and-without-changes-in-the-rate-of-evolution">5.1 Multivariate unbiased random walks with and without changes in
the rate of evolution<a class="anchor" aria-label="anchor" href="#multivariate-unbiased-random-walks-with-and-without-changes-in-the-rate-of-evolution"></a>
</h4>
<p>Evolution as a multivariate unbiased random walk is modeled using an
evolutionary rate matrix <strong>R</strong>. The diagonal elements in
<strong>R</strong> represent the rate of evolution for the individual
traits, while the off-diagonal elements represent the extent to which
different traits co-evolve. The multivariate variance-covariance matrix
for the Unbiased random walk model (<strong>V</strong>) is computed
using the Kronecker product of the <strong>R</strong> matrix and a
“distance matrix” <strong>C</strong>, describing the distance in time
between the different samples/populations in the time-series. Sampling
error of the trait mean (calculated as the sample variance divided by
the sample size) is – as for all models in <code>evoTS</code> – added to
the diagonal of the <strong>V</strong> matrix. To ensure symmetric
positive definiteness of the <strong>V</strong> matrix during
log-likelihood optimization, <strong>R</strong> is parameterized by its
Cholesky decomposition as the cross-product of upper triangular
matrices. In cases where different parts of the evolutionary time-series
are described by <span class="math inline">\(R_{m}\)</span> matrices,
<strong>V</strong> is computed as the sum of the different <span class="math inline">\(R_{m}\)</span> and <span class="math inline">\(C_{m}\)</span> matrices:</p>
<p><span class="math display">\[V = \sum_{i=1}^{m} R_{m} \otimes
C_{m}\]</span></p>
<p>The current implementation of the multivariate unbiased random walk
model allows testing six variants of the model. The six variants of the
model can be fitted using different specifications of <code>R</code> and
<code>r</code> in the <code>fit.multivariate.URW</code> function.</p>
<p>The <code>R</code> option defines which elements in the
<strong>R</strong> matrix that will be estimated. There are two options
for the structure of the <strong>R</strong> matrix. Setting
<code>R = "diagonal"</code> means only the diagonal elements of the
<strong>R</strong> matrix will be estimated while off-diagonal elements
are set to (see panel a below) This parameterization of the
<strong>R</strong> matrix means the stochastic changes in the traits are
assumed to be uncorrelated. Setting <code>R = "symmetric"</code> means
all (both diagonal and off-diagonal) elements in the R matrix are
estimated (panel b below). This parameterization means the stochastic
changes in the traits are assumed to be correlated, i.e. that
evolutonary changes are non-independent.</p>
<p><img src="R_matrices.png" width="40%" style="display: block; margin: auto;"></p>
<p>The argument <code>r</code> in the <code>fit.multivariate.URW</code>
function defines whether the rate of change is assumed constant
(“fixed”), asymptotically decreasing (“decel”), or asymptotically
increasing (“accel”) with time. Defining <code>r</code> as “fixed” means
a regular multivariate unbiased random walk will be fitted to the data.
The “decel” and “accel” options fits multivariate versions of the
decelerated and accelerated versions of the unbiased random walk,
respectively. These latter two models deviate from the multivariate
unbiaseed random walk in that the distance matrix <strong>C</strong> is
transformed by an exponential decay or acceleration parameter,
<em>r</em>, that is jointly estimated during the maximum likelihood
search for the <strong>R</strong> matrix. A common <em>r</em> parameter
is assumed for all the traits.</p>
<p>To use the multivariate models, we first need multivariate data
(e.g. at least two traits or variables).</p>
<p>The dataset on phenotypic evolution in <em>Stephanodiscus
yellowstonensis</em> (Theirot et al. 2006) contains data on the number
of ribs in addition to the size measure we have analyzed so far. To make
the rib data set ready for multivariate analyses together with the size
(diameter) data set, we first do an approximate log-transformation of
the riv data and convert the time vector to unit length.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Doing an approximate log-transformation of the data</span>
<span class="va">ln.ribs</span><span class="op">&lt;-</span><span class="fu">paleoTS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/paleoTS/man/ln.paleoTS.html" class="external-link">ln.paleoTS</a></span><span class="op">(</span><span class="va">ribs_S.yellowstonensis</span><span class="op">)</span>

<span class="co">## Convert the time vector to unit length</span>
<span class="va">ln.ribs</span><span class="op">$</span><span class="va">tt</span><span class="op">&lt;-</span><span class="va">ln.ribs</span><span class="op">$</span><span class="va">tt</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ln.ribs</span><span class="op">$</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To make a multivariate data set ready to be analyzed in evoTS, we
combine the two paleoTS objects into a multivariate evoTS object using
the make.multivar.evoTS function.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diam.ln_ribs.ln</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/make.multivar.evoTS.html">make.multivar.evoTS</a></span><span class="op">(</span><span class="va">ln.diameter</span>, <span class="va">ln.ribs</span><span class="op">)</span></code></pre></div>
<p>We can use the plotevoTS.multivariate function to have a look at the
combined data set.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotevoTS.multivariate</span>(diam.ln_ribs.ln, <span class="at">y_min=</span><span class="fl">3.4</span>, <span class="at">y_max=</span><span class="fl">4.8</span>, <span class="at">x.label =</span> <span class="st">"Relative time"</span>, <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>)</span></code></pre></div>
<p><img src="diam_and_ribs.png" width="60%" style="display: block; margin: auto;"></p>
<p>Eye-balling the data seems to suggest that the traits change in a
coordinated fashion.</p>
<p>We first fit a multivariate unbiased random walk model where the
off-diagonal elements in the <strong>R</strong> matrix are zero, and the
rate of evolution is assumes constant. This is equivalent as fitting to
separate univariate unbiased random walks models to each of the two
time-series.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fit.multivariate.URW</span>(diam.ln_ribs.ln, <span class="at">R =</span> <span class="st">"diag"</span>, <span class="at">r =</span> <span class="st">"fixed"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Multivariate Random walk (R matrix with zero off-diagonal elements)"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">135.8697</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">263.0498</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ancestral.values</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.715649</span> <span class="fl">4.013975</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.2555386</span> <span class="fl">0.0000000</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.0000000</span> <span class="fl">0.4695467</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>SE.R</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>The returned parameters include the ancestral trait values for the
two traits and the evolutionary rate matrix <strong>R</strong>. The
diagonal in the <strong>R</strong> matrix contains the step size (rate
of evolution) parameters. The first trait (diameter) has about twice the
rate of evolution as the second parameter (ribs). The off-diagonal
elements are zero as this model is not estimating the covariation of the
evolutionary changes.</p>
<p>Next, we fit a model that allows the off-diagonal elements in the R
matrix to be different from zero. We do this by setting
<code>R = symmetric</code>. We are still keeping the rate of change
fixed.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fit.multivariate.URW</span>(diam.ln_ribs.ln, <span class="at">R =</span> <span class="st">"symmetric"</span>, <span class="at">r =</span> <span class="st">"fixed"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Multivariate Random walk (R matrix with non-zero off-diagonal elements)"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">181.8526</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">352.6525</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ancestral.values</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.719176</span> <span class="fl">4.029796</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.2787967</span> <span class="fl">0.3878622</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.3878622</span> <span class="fl">0.5635895</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>SE.R</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>A multivariate random walk has a much better fit compared to treating
the traits univariately according to AICc. This indicates that the
traits are not evolving independently of each other. The estimated
<em>R</em> matrix indicates that the first trait has about half the rate
of evolution as the second trait and that there is substantial
covariance in the evolutionary changes of the two traits. The
evolutionary correlation can be computed by standardizing the covariance
with the product of the standard deviations on the diagonal (This can
also be using the function cov3cor in the <code>stats</code>
package).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3878622</span><span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="fl">0.2787967</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fl">0.5635895</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9784805</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or alternatively:</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> model1<span class="ot">&lt;-</span><span class="fu">fit.multivariate.URW</span>(diam.ln_ribs.ln, <span class="at">R =</span> <span class="st">"symmetric"</span>, <span class="at">r =</span> <span class="st">"fixed"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> stats<span class="sc">::</span><span class="fu">cov2cor</span>(model1<span class="sc">$</span>R)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">1.0000000</span> <span class="fl">0.9784806</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.9784806</span> <span class="fl">1.0000000</span></span></code></pre></div>
<p>A correlation of 0.98 basically means the two traits can be
considered to evolve as a single trait. Given that at least part of the
deviation from a correlation of unity is due to measurement error, this
is a very strong indication that the traits are evolving as one
trait</p>
<p>Note that the <strong>R</strong> matrix is not describing the
underlying genetic or phenotypic (co)variances of the traits. The
<strong>R</strong> matrix is therefore not the same as a
<strong>P</strong> (or <strong>G</strong>) matrix. However, the
<strong>R</strong> matrix is tightly connected to these matrices within
evolutionary quantitative genetics. For example, if the traits evolve
only due to drift, the <strong>R</strong> matrix is expected to be
proportional to the additive genetic variance–covariance matrix
(<strong>G</strong>) matrix (Lande 1979; Felsenstein 1988). Estimating
<strong>R</strong> can therefore aid in evolutionary interpretations of
the fossil record anchored in evolutionary quantitative genetics.</p>
<p>Standard errors of the elements in the R matrix can be approximated
by the square roots of the diagonal elements of the inverse of the
negative of the Hessian matrix. These standard errors are automatically
estimated and reported if the argument <code>hess=TRUE</code> in
defined.</p>
<p>Parameterizing multivariate models is demanding in relation to
computational time (Felsenstein 1973; Hadfield and Nakagawa 2010;
Freckleton 2012). Be aware that fitting the multivariate models to
several traits with many samples (populations) will take much longer
time than fitting univariate models to each trait separately. One way to
somewhat follow the progress of the model fit is to set
<code>trace = TRUE</code>. This allows the user to follow the progress
of the optimization routine to minimize the likelihood function.</p>
<p>The likelihood surface of multivariate models can contain several
local peaks. It is therefore recommended to rerun the model fit from
different starting points (i.e., different initial values). The number
of iterations can be defined by the iterations argument (e.g.,
<code>iterations = 10</code>). Initial values for the search algorithm
are drawn from a normal distribution with a default standard deviation
of 1. The user can set this standard deviation by the iter.sd argument.
(e.g., <code>iter.sd = 0.5</code>).</p>
<p>We can check if we find evidence for a change in the
<strong>R</strong> matrix along the time-series. This involves
estimating a separate <strong>R</strong> matrix for two non-overlapping
parts of the time-series. This is done using the function
<code>fit.multivariate.URW.shift</code>. We can define the shift point
using the argument <code>shift.point</code> (e.g.,
<code>shift.point = 20</code>) or we can investigate all possible shift
points in the time series by not defining a shift point (the default
option). The length of the smallest number of samples (populations) in
each of the two segments is controlled by the <code>minb</code> argument
(the default is 10).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fit.multivariate.URW.shift</span>(diam.ln_ribs.ln, <span class="at">hess =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Searching for all possible switchpoints in timeseries"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Total <span class="co"># hypotheses:  44 </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  [<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  [<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Omitted some of the printed output </span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="dv">44</span>  [<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>modelName</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Multivariate Random walk with two R matrices (with non-zero off-diagonal elements)"</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">189.7424</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">358.0887</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ancestral.values</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.728940</span> <span class="fl">4.055547</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R<span class="sc">$</span>R<span class="fl">.1</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.3633035</span> <span class="fl">0.6331324</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.6331324</span> <span class="fl">1.1402896</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R<span class="sc">$</span>R<span class="fl">.2</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.2220926</span> <span class="fl">0.2712090</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.2712090</span> <span class="fl">0.3376271</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>SE.R</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>SE.R<span class="sc">$</span>SE.R<span class="fl">.1</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>           [,<span class="dv">1</span>]       [,<span class="dv">2</span>]</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.01701042</span> <span class="fl">0.02975274</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.02975274</span> <span class="fl">0.06850436</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>SE.R<span class="sc">$</span>SE.R<span class="fl">.2</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>            [,<span class="dv">1</span>]        [,<span class="dv">2</span>]</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.003426091</span> <span class="fl">0.004333208</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.004333208</span> <span class="fl">0.006481010</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">9</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>parameters</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>shift1 </span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    <span class="dv">18</span> </span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>all.logl</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="fl">186.3352</span> <span class="fl">184.1136</span> <span class="fl">185.2123</span> <span class="fl">188.5563</span> <span class="fl">188.9149</span> <span class="fl">186.5875</span> <span class="fl">186.0033</span> <span class="fl">189.7424</span> <span class="fl">186.3212</span> <span class="fl">186.2200</span> <span class="fl">185.5447</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>[<span class="dv">12</span>] <span class="fl">184.9384</span> <span class="fl">184.4486</span> <span class="fl">184.0647</span> <span class="fl">187.5535</span> <span class="fl">185.1279</span> <span class="fl">186.3236</span> <span class="fl">186.3285</span> <span class="fl">187.3570</span> <span class="fl">185.9061</span> <span class="fl">185.2030</span> <span class="fl">186.0518</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>[<span class="dv">23</span>] <span class="fl">186.3088</span> <span class="fl">184.8322</span> <span class="fl">184.9602</span> <span class="fl">184.2766</span> <span class="fl">185.0280</span> <span class="fl">185.3865</span> <span class="fl">184.2946</span> <span class="fl">183.7373</span> <span class="fl">182.9746</span> <span class="fl">182.5979</span> <span class="fl">181.3128</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] <span class="fl">180.8803</span> <span class="fl">181.0370</span> <span class="fl">180.4002</span> <span class="fl">179.8530</span> <span class="fl">179.5366</span> <span class="fl">179.5296</span> <span class="fl">179.5023</span> <span class="fl">179.6067</span> <span class="fl">179.4793</span> <span class="fl">179.3429</span> <span class="fl">179.4833</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>GG</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>] [,<span class="dv">4</span>] [,<span class="dv">5</span>] [,<span class="dv">6</span>] [,<span class="dv">7</span>] [,<span class="dv">8</span>] [,<span class="dv">9</span>] [,<span class="dv">10</span>] [,<span class="dv">11</span>] [,<span class="dv">12</span>] [,<span class="dv">13</span>] [,<span class="dv">14</span>] [,<span class="dv">15</span>] [,<span class="dv">16</span>] [,<span class="dv">17</span>] [,<span class="dv">18</span>]</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]   <span class="dv">11</span>   <span class="dv">12</span>   <span class="dv">13</span>   <span class="dv">14</span>   <span class="dv">15</span>   <span class="dv">16</span>   <span class="dv">17</span>   <span class="dv">18</span>   <span class="dv">19</span>    <span class="dv">20</span>    <span class="dv">21</span>    <span class="dv">22</span>    <span class="dv">23</span>    <span class="dv">24</span>    <span class="dv">25</span>    <span class="dv">26</span>    <span class="dv">27</span>    <span class="dv">28</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">19</span>] [,<span class="dv">20</span>] [,<span class="dv">21</span>] [,<span class="dv">22</span>] [,<span class="dv">23</span>] [,<span class="dv">24</span>] [,<span class="dv">25</span>] [,<span class="dv">26</span>] [,<span class="dv">27</span>] [,<span class="dv">28</span>] [,<span class="dv">29</span>] [,<span class="dv">30</span>] [,<span class="dv">31</span>] [,<span class="dv">32</span>] [,<span class="dv">33</span>] [,<span class="dv">34</span>]</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">29</span>    <span class="dv">30</span>    <span class="dv">31</span>    <span class="dv">32</span>    <span class="dv">33</span>    <span class="dv">34</span>    <span class="dv">35</span>    <span class="dv">36</span>    <span class="dv">37</span>    <span class="dv">38</span>    <span class="dv">39</span>    <span class="dv">40</span>    <span class="dv">41</span>    <span class="dv">42</span>    <span class="dv">43</span>    <span class="dv">44</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">35</span>] [,<span class="dv">36</span>] [,<span class="dv">37</span>] [,<span class="dv">38</span>] [,<span class="dv">39</span>] [,<span class="dv">40</span>] [,<span class="dv">41</span>] [,<span class="dv">42</span>] [,<span class="dv">43</span>] [,<span class="dv">44</span>]</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">45</span>    <span class="dv">46</span>    <span class="dv">47</span>    <span class="dv">48</span>    <span class="dv">49</span>    <span class="dv">50</span>    <span class="dv">51</span>    <span class="dv">52</span>    <span class="dv">53</span>    <span class="dv">54</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span></code></pre></div>
<p>Two <strong>R</strong> matrices are returned (R.1 and R.2), along
with their standard errors (since we used <code>hess = TRUE</code>). The
estimated shift point is 18 (<em>shift1</em>), which is the same shift
point we detected when fitting the Bokma model to the diameter time
series. The rate of evolution is much larger in the second trait
compared to the first trait (the diagonal elements in R.1) while the
difference in rate of evolution is much smaller after the shift point
(the diagonal elements in R.2). The evolutionary correlation is 0.98 and
0.99 before and after the shift point. The number of parameters
(<em>K</em>) for this model is 9 compared to 5 for the model where we
estimated a single <em>R</em> matrix for the multivariate data set. The
model with two <em>R</em> matrices has a lower (better) AICc score
compared to the model with a single R matrix. This difference in AICc
scores is likely to be a result of the differences in rates of evolution
in R.1 and R.2 since the evolutionary correlation is estimated to be
very similar in both R.1 and R.2.</p>
<p>We now check if the multivariate accelerated and decelerated models
have a better fit than the multivariate random walk models.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> multi.accel<span class="ot">&lt;-</span><span class="fu">fit.multivariate.URW</span>(diam.ln_ribs.ln, <span class="at">R =</span> <span class="st">"symmetric"</span>, <span class="at">r =</span> <span class="st">"accel"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> multi.decel<span class="ot">&lt;-</span><span class="fu">fit.multivariate.URW</span>(diam.ln_ribs.ln, <span class="at">R =</span> <span class="st">"symmetric"</span>, <span class="at">r =</span> <span class="st">"decel"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Model converged successfully."</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> multi.accel<span class="sc">$</span>AICc;multi.decel<span class="sc">$</span>AICc</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">336.454</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">351.5167</span></span></code></pre></div>
<p>The multivariate decelerated evolution model has a similar (but
slightly worse) fit to the data compared to the multivariate unbiased
random walk model with a single <strong>R</strong> matrix, but is
outcompeted by the model with two <strong>R</strong> matrices.</p>
</div>
<div class="section level4">
<h4 id="multivariate-ornstein-uhlenbeck-models">5.2 Multivariate Ornstein-Uhlenbeck models<a class="anchor" aria-label="anchor" href="#multivariate-ornstein-uhlenbeck-models"></a>
</h4>
<p>The multivariate Ornstein-Uhlenbeck process is described by the
following differential equation:</p>
<p><span class="math display">\[dY = A(\theta(t)-Y(t))dt +
RdW(t)\]</span> where <em>A</em> is square matrix with dimensions equal
to the number of investigated traits that describes the rate of
evolution toward the optimal trait values (<strong>A</strong> is often
called the pull matrix), <span class="math inline">\(\theta\)</span> is
a vector containing the optimum for each trait, <strong>R</strong> is a
square matrix with dimensions equal to the number of investigated traits
describing the stochastic changes in the traits (<strong>R</strong> is
often called the drift matrix) (Bartoszek <em>et al.</em> 2012; Reitan
<em>et al.</em> 2012; Clavel <em>et al.</em> 2015). Under the assumption
that the we only have one selective regime (optimum) per trait, the
expected trait mean of the Ornstein-Uhlenbeck process is the weighted
sum of the optimum and the root value (Hansen 1997):</p>
<p><span class="math display">\[E\left[Z_{i}\right]= e^{(-At_{i})}z_{0}
+ (1-e^{(-At_{i})}\theta)\]</span> where <span class="math inline">\(Z_{i}\)</span> is the expected trait value for
sample <em>i</em>, <span class="math inline">\(z_{0}\)</span> is the
ancestral trait mean, <em>Θ</em> is the optimum, <em>A</em> is the pull
matrix measures the rate of adaptation to the optimum, and <span class="math inline">\(t_{i}\)</span> is the time interval from the
ancestral population mean (the start of the time-series, which has a
time of 0) to the ith population mean.</p>
<p>The variance and covariance of sample means are given by the
following expression:</p>
<p><span class="math display">\[Cov(z_{i}, z_{j})=\left[P\left( \left[
\frac{1}{\lambda_{k} + \lambda_{l}} \left( 1-e^{-({\lambda_{k} +
\lambda_{l})}t_{a}}\right)\right]_{1\le kl \le m}   \odot
P^{-1}\Sigma\Sigma^{T}(P^{-1})^{T}\right)
P^{T}\right]e^{-A^{T}t_{ij}}\]</span> where P is the orthogonal matrix
of eigenvectors of A, <span class="math inline">\(\Sigma\Sigma^{T}\)</span> is the Cholesky
decomposition of the <em>R</em> matrix, <span class="math inline">\(\lambda_{i}\)</span> is the eigenvalue of the ith
trait, <span class="math inline">\(t_{a}\)</span> is the time interval
from the ancestral population to the oldest of the two populations <span class="math inline">\(z_{i}\)</span> and <span class="math inline">\(z_{j}\)</span>, and <span class="math inline">\(t_{ij}\)</span> is the time separating two samples
z_i and z_j, while <span class="math inline">\(\odot\)</span> represents
the Hadamard (element-wise) product.</p>
<p>Different ways to parameterize the A matrix allows testing a range of
evolutionary hyptheses using the multivariate OU process. While the R
matrix in the multivariate version of unbiased random walk (and in the
multivariate OU model) either needs to be diagonal (only elements on the
diagonal while off-diagonal elements are zero) or complete (in the sense
that both the diagonal and off-diagonal elements are non-zero), this is
not the case for the A matrix. Generally, we can divide up the
hypotheses being tested using the multivariate OU into four different
types:</p>
<ul>
<li>Independent evolution (only diagonal elements in both the A and the
R matrix, i.e. equivalent as fitting univariate models to each trait
separately.)</li>
<li>Independent adaptation (only diagonal elements in the A matrix while
the R matrix is completely parameterized. In such a model, the traits
are adapting independently toward their optima, but the stochastic
changes in the trait are correlated.)</li>
<li>At least one trait affects the optimum of the other trait. The
diagonal and at least one of the off-diagonal elements in the A matrix
is non-zero. It is the trait in the column of the non-zero off-diagonal
element that affects the optimum of the trait in the row of the non-zero
off-diagonal element. The the stochastic changes in the trait can be
either correlated or non-correlated.</li>
<li>At least two traits affect each others optimum. Symmetric
off-diagonal elements are present in the A matrix. The the stochastic
changes in the trait can be either correlated or non-correlated.</li>
</ul>
<p>For a dataset consisting of two traits, there are four possible
parameterization of the A matrix (see panels below). Independent
adaptation of both traits (panel a), trait Y affecting the optimum of
trait X (panel b), trait X affects the optimum of trait Y, and the
traits X and why affects each others optimum (panel d). Each of these
four ways of parameterizing the A matrix can be combined with an R
matrix with elements only on the diagonal (the stochastic changes in the
traits are uncorrelated) or a completely parameterized R matrix (the
stochastic changes in the traits are correlated).</p>
<p><img src="A_matrices.png" width="40%" style="display: block; margin: auto;"></p>
<p>It is also possible to implement a model where the last trait in the
data set evolve as an unbiased random walk which affects the optima for
all other traits in the data set. This model can be fitted by defining
A.matrix =“OUBM”, which sets the last diagonal element in the A matrix
to zero. A zero diagonal element in the A matrix means there is no
tendency for this trait to evolve towards an optimal value (which is the
case for an unbiased random walk. Setting A.matrix =“OUBM” will
automaticall define the R matrix to only have diagonal elements
(i.e. this option for the A matrix will override how the R matrix is
defined by the user).</p>
<p>Multivariate Ornstein-Uhlenbeck models can be fitted using two
different funcions in the <code>evoTS</code> package. The function
<code>fit.multivariate.OU</code> allows the user to define the
parameterization of the A and R matrix using different arguments for the
A and R matrices. The A.matrix can either be defined as “diag” (panel a
above), “upper.tri” (panel b above) and “lower.tri” (panel c above), and
“full” (panel d above). Default is “diag”. The R.matrix can be defined
as “diag” or “symmetric”. The function
<code>fit.multivariate.OU.user.defined</code> lets the user define which
elements in the A and R matrices that should be parameterized. This
function therefore allows full flexibility for the type of hypotheses
that are being tested as the parameterization is not constrained to
follow the pre-defined options for the A matrix available in the
function <code>fit.multivariate.OU</code>.</p>
<p>We will investigate whether the two traits from the S.
yellowstonensis lineage show evidence of independent evolution (only
diagonal elements in the A and R matrices) or whether only the
adaptation part of the trait dynamics is independent in the two traits
(diagonal A matrix and symmetric R matrix). We will test these
hypotheses using the <code>fit.multivariate.OU</code> function.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> OUOU.model1<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU</span>(diam.ln_ribs.ln, <span class="at">A.matrix=</span><span class="st">"diag"</span>, <span class="at">R.matrix=</span><span class="st">"diag"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> OUOU.model2<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU</span>(diam.ln_ribs.ln, <span class="at">A.matrix=</span><span class="st">"diag"</span>, <span class="at">R.matrix=</span><span class="st">"symmetric"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> OUOU.model1<span class="sc">$</span>AICc;OUOU.model2<span class="sc">$</span>AICc</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">267.3968</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">352.6936</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> OUOU.model2</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>logL</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">187.0449</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>AICc</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">352.6936</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ancestral.values</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.723814</span> <span class="fl">4.019919</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>optima</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.884587</span> <span class="fl">4.292756</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>A</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>]     [,<span class="dv">2</span>]</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">11.32494</span>  <span class="fl">0.00000</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,]  <span class="fl">0.00000</span> <span class="fl">14.17131</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>half.life</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.06120538</span> <span class="fl">0.04891201</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>R</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>           [,<span class="dv">1</span>]       [,<span class="dv">2</span>]</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.01981394</span> <span class="fl">0.07535918</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.07535918</span> <span class="fl">0.91001729</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>method</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Joint"</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>K</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">9</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>n</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>iter</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(,<span class="st">"class"</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"paleoTSfit"</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>stats<span class="sc">::</span><span class="fu">cov2cor</span>(OUOU.model2<span class="sc">$</span>R)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>]</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">1.0000000</span> <span class="fl">0.5612106</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.5612106</span> <span class="fl">1.0000000</span></span></code></pre></div>
<p>The model with independent adaptation and correlated stochastic
changes is much better than the independent evolution model. This is not
necessarily surprising as we know the changes in the traits are
correlated from our investigation of the multivariate unbiased random
walk models. The half-life for the log diameter and log number of ribs
are 6.1% and 4.9% of the length of the time-series, which translates
into (13728 * 0.061 =) 837 and (13728 * 0.049 =) 673 years respectively.
The correlation of the stochastic changes is substantial, but much
reduced compared to the estimate of the correlation from the unbiased
random walks. This is because a substantial part of the trait dynamics
in a multivariate OU model is due to the deterministic approach of the
traits towards the optima. The model has an almost identical relative
fit compared to the multivariate unbiased random walk according to AICc,
but is out-competed by the unbiased random walk with a switch in the
rate of evolution.</p>
<p>We now test more if a more complex parameterization of the A matrix
gives us a better relative fit.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>OUOU.model3<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU</span>(diam.ln_ribs.ln, <span class="at">A.matrix=</span><span class="st">"upper.tri"</span>, <span class="at">R.matrix=</span><span class="st">"symmetric"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>OUOU.model4<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU</span>(diam.ln_ribs.ln, <span class="at">A.matrix=</span><span class="st">"full"</span>, <span class="at">R.matrix=</span><span class="st">"symmetric"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>OUOU.model5<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU</span>(diam.ln_ribs.ln, <span class="at">A.matrix=</span><span class="st">"OUBM"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>OUOU.model3<span class="sc">$</span>AICc;OUOU.model4<span class="sc">$</span>AICc;OUOU.model5<span class="sc">$</span>AICc</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">349.9107</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">349.8412</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">301.516</span></span></code></pre></div>
<p>None of the models with off-diagonal elements in the A matrix show a
better relative fit than the model with a diagonal A and a symmetric R
matrix. The best model we have investigated remains the multivariate
unbiased random walk with a mode shift, allowing two different unbiased
random walks explain the trait dynamics.</p>
<p>However, before we trust this result, we should make sure to run the
multivariate OU models from different initial starting values, to
increase our chances of finding a (potentially) different peak in the
log-likelihood surface. The number of iterations can be defined by the
<code>iterations</code> argument. The starting values are drawn from a
normal distribution with a standard deviation of one. The user can
define a larger or smaller standard deviation using the argument
<code>iter.sd</code>. trace = TRUE allows the user to keep an eye on how
the optimization proceeds.</p>
<p>To illustrate how the user can define which elements in the A and R
matrices that should be parameterized using the function
<code>fit.multivariate.OU.user.defined</code>, we can fit a lower
triangle A matrix and a symmetric R matrix. A lower triangle A matrix
means the diameter is affecting the optimum of the number of ribs.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>OUOU.model6<span class="ot">&lt;-</span><span class="fu">fit.multivariate.OU.user.defined</span>(diam.ln_ribs.ln, <span class="at">A.user=</span>A, <span class="at">R.user=</span>R)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> OUOU.model6<span class="sc">$</span>AICc</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">349.357</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">6.0 References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bartoszek, K., J. Pienaar, P. Mostad, S. Andersson, and T. F. Hansen.
2012 A phylogenetic comparative method for studying multivariate
adaptation. <em>Journal of Theoretical Biology</em> 314:204–215.</p>
<p>Bokma, F. 2002. Detection of punctuated equilibrium from molecular
phylogenies. <em>Journal of Evolutionary Biology</em> 15:1048–1056..</p>
<p>Clavel, J., G. Escarguel, G. Merceron. 2015. mvmorph: an r package
for fitting multivariate evolutionary models to morphometric data.
<em>Methods in Ecology and Evolution</em> 6:1311–1319.</p>
<p>Edwards, A. W. F. 1992. Likelihood. expanded edition Johns Hopkins
University Press. Baltimore, MD.</p>
<p>Hansen, T. F. 1997. Stabilizing selection and the comparative
analysis of adaptation. <em>Evolution</em> 51:1341–1351.</p>
<p>Hansen, T. F., J. Pienaar, and S. H. Orzack. 2008. A comparative
method for studying adaptation to a randomly evolving environment.
<em>Evolution</em> 62:1965–1977.</p>
<p>Hunt, G. 2006. Fitting and comparing models of phyletic evolution:
random walks and beyond. <em>Paleobiology</em> 32:578–601.</p>
<p>Hunt, G. 2008a. Gradual or pulsed evolution: when should
punctuational explanations be preferred? <em>Paleobiology</em>
34:360–377.</p>
<p>Hunt, G. 2008b. Evolutionary patterns within fossil lineages:
model-based assessment of modes, rates, punctuations and process. In
R.K. Bambach and P.H. Kelley, eds. From Evolution to Geobiology:
Research Questions Driving Paleontology at the Start of a New
Century:578–601.</p>
<p>Hunt, G., M. Bell &amp; M. Travis. 2008. Evolution towards a new
adaptive optimum: phenotypic evolution in a fossil stickleback lineage.
<em>Evolution</em> 62:700-710.</p>
<p>Hunt, G., S. Wicaksono, J. E. Brown, and G. K. Macleod. 2010.
Climate-driven body size trends in the ostracod fauna of the deep Indian
Ocean. <em>Palaeontology</em> 53:1255-1268.</p>
<p>Hunt, G., M. J. Hopkins, and S. Lidgard. 2015 Simple versus complex
models of trait evolution and stasis as a response to environmental
change. <em>PNAS</em> 112:4885–4890.</p>
<p>Reitan, T., T. Schweder, and J. Henderiks. 2012. Phenotypic evolution
studied by layered stochastic differential equations. <em>The Annals of
Applied Statistics</em>. 6:1531–1551.</p>
<p>Voje, K. L. 2020. Testing eco‐evolutionary predictions using fossil
data: Phyletic evolution following ecological opportunity.
<em>Evolution</em> 74:188–200.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kjetil Lysne Voje.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
